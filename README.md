# Airdrop - 跨平台文件传输应用

一个现代化的局域网文件传输应用，支持桌面端和移动端之间快速传输文件和文本。

## 主要特性

### 🚀 核心功能
- **文件传输**：支持任意类型和大小的文件传输
- **文本分享**：快速分享文本消息和链接
- **历史记录**：自动保存传输历史，方便查看和重新下载
- **多设备支持**：同时连接多个设备

### 📱 移动端优化
- **PWA 支持**：可添加到主屏幕，像原生应用一样使用
- **自动发现**：手机端自动探测局域网内的桌面端
- **iOS 优化**：完美支持 iOS Safari 和 PWA
- **响应式设计**：适配各种屏幕尺寸

### 💻 桌面端功能
- **系统托盘**：最小化到系统托盘，后台运行
- **拖放支持**：直接拖放文件到窗口
- **快捷键**：支持常用快捷键操作
- **自动更新**：内置更新检查和自动更新

### 🎨 用户体验
- **深色模式**：支持深色/浅色主题切换
- **主题色**：多种主题色可选
- **实时进度**：文件传输实时显示进度
- **通知提醒**：接收文件时桌面通知

## 技术栈

### 桌面端
- **Electron** - 跨平台桌面应用框架
- **React** - UI 框架
- **TypeScript** - 类型安全
- **Vite** - 构建工具

### 移动端
- **React** - UI 框架
- **Socket.IO** - 实时通信
- **PWA** - 渐进式 Web 应用
- **Tailwind CSS** - 样式框架

### 通信协议
- **Socket.IO** - WebSocket 实时通信
- **HTTP** - 文件传输
- **UDP 广播** - 设备发现
- **mDNS/Bonjour** - 服务发现

## 快速开始

### 安装依赖
```bash
npm install
```

### 开发模式

**启动桌面端**
```bash
npm run dev
```

**启动移动端（Web）**
```bash
npm run dev:web
```

### 构建

**构建桌面端**
```bash
npm run build
```

**构建移动端**
```bash
npm run build:web
```

**打包桌面端应用**
```bash
npm run dist
```

## 使用说明

### 桌面端

1. **启动应用**
   - 运行桌面端应用
   - 应用会自动启动 Web 服务器和设备发现服务

2. **连接设备**
   - 查看应用显示的 IP 地址和二维码
   - 手机扫描二维码或输入 IP 地址访问

3. **传输文件**
   - 选择目标设备
   - 拖放文件或点击选择文件
   - 点击发送按钮

### 移动端

1. **访问应用**
   - 扫描桌面端显示的二维码
   - 或在浏览器中输入桌面端的 IP 地址

2. **自动发现**
   - 应用会自动搜索局域网内的桌面端
   - 点击发现的服务器即可连接

3. **添加到主屏幕**
   - iOS：Safari 浏览器 → 分享 → 添加到主屏幕
   - Android：Chrome 浏览器 → 菜单 → 添加到主屏幕

4. **传输文件**
   - 点击文件/照片按钮选择文件
   - 选择目标设备
   - 点击发送

## 功能文档

### UDP 自动发现
详见 [UDP_DISCOVERY_GUIDE.md](./UDP_DISCOVERY_GUIDE.md)

### iOS 下载优化
详见 [IOS_DOWNLOAD_FIX.md](./IOS_DOWNLOAD_FIX.md)

## 项目结构

```
├── src/
│   ├── main/           # Electron 主进程
│   │   ├── services/   # 服务（文件传输、设备发现等）
│   │   ├── ipc/        # IPC 通信处理
│   │   └── utils/      # 工具函数
│   ├── renderer/       # Electron 渲染进程（桌面端 UI）
│   ├── web/            # 移动端 Web 应用
│   │   ├── components/ # React 组件
│   │   ├── hooks/      # 自定义 Hooks
│   │   ├── pages/      # 页面组件
│   │   └── utils/      # 工具函数
│   └── shared/         # 共享代码
│       ├── components/ # 共享组件
│       └── utils/      # 共享工具
├── public/             # 静态资源
└── build/              # 构建配置

```

## 配置

### 端口配置
- Web 服务器：8080（可在代码中修改）
- UDP 广播：3001
- Socket.IO：与 Web 服务器同端口

### 环境变量
```env
NODE_ENV=development  # 开发模式
NODE_ENV=production   # 生产模式
```

## 常见问题

### 1. 手机无法连接桌面端
- 确保手机和电脑在同一 WiFi 网络
- 检查防火墙是否允许应用访问网络
- 尝试手动输入 IP 地址

### 2. iOS 下载文件后无法返回
- 已修复：使用 Fetch + Blob 方式下载
- 确保使用最新版本

### 3. 文件传输失败
- 检查网络连接
- 确保有足够的磁盘空间
- 尝试重新连接

### 4. 设备发现失败
- 确保在同一局域网
- 检查 UDP 端口 3001 是否被占用
- 尝试手动输入 IP 地址

## 开发指南

### 添加新功能
1. 在 `src/main/services/` 添加服务
2. 在 `src/main/ipc/` 添加 IPC 处理
3. 在 `src/renderer/` 或 `src/web/` 添加 UI

### 调试
- 桌面端：按 F12 打开开发者工具
- 移动端：使用浏览器开发者工具

### 测试
```bash
npm test
```

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！

## 更新日志

### v1.7.0 (2024-02-02)
- ✨ 新增 UDP 广播自动发现功能
- ✨ iOS 下载优化，避免页面跳转
- ✨ 移动端导航悬浮优化
- 🐛 修复 iOS 下载后无法返回问题
- 🐛 修复移动端导航遮挡内容问题
- 📱 支持实时下载进度显示
- 🎨 优化移动端布局和交互
